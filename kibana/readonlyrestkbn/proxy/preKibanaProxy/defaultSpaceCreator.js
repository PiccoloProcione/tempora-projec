"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.DefaultSpaceCreator=void 0;var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator"));var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));var _rorLoggerFactory=require("../core/logging/rorLoggerFactory");var __awaiter=void 0&&(void 0).__awaiter||function(e,s,r,c){function o(t){return t instanceof r?t:new r(function(e){e(t)})}return new(r||(r=Promise))(function(t,r){function a(e){try{i(c.next(e))}catch(e){r(e)}}function n(e){try{i(c["throw"](e))}catch(e){r(e)}}function i(e){e.done?t(e.value):o(e.value).then(a,n)}i((c=c.apply(e,s||[])).next())})};var DefaultSpaceCreator=function e(t,r){var i=this;(0,_classCallCheck2.default)(this,e);this.logger=_rorLoggerFactory.RorLoggerFactory.getLoggerForFile(__filename);this.DEFAULT_SPACE_DOCUMENT_ID="space:default";this.DEFAULT_SPACE_DOCUMENT_BODY={space:{name:"Default",description:"This is your default space! (created by ReadonlyREST Enterprise)",color:"#00bfb3",disabledFeatures:[],_reserved:true},type:"space",references:[],migrationVersion:{space:"6.6.0"}};this.createDefaultSpaceDocumentIfNeeded=function(a){return __awaiter(i,void 0,void 0,_regenerator.default.mark(function e(){var r;return _regenerator.default.wrap(function e(t){while(1){switch(t.prev=t.next){case 0:t.next=2;return this.spaceDocumentExists(a);case 2:r=t.sent;if(r){t.next=6;break}t.next=6;return this.createDefaultSpaceDocument(a,this.DEFAULT_SPACE_DOCUMENT_BODY);case 6:case"end":return t.stop()}}},e,this)}))};this.spaceDocumentExists=function(a){return __awaiter(i,void 0,void 0,_regenerator.default.mark(function e(){var r=this;return _regenerator.default.wrap(function e(t){while(1){switch(t.prev=t.next){case 0:t.next=2;return this.esClient.getAsKibana(a+"/_doc/".concat(this.DEFAULT_SPACE_DOCUMENT_ID)).then(function(a){return __awaiter(r,void 0,void 0,_regenerator.default.mark(function e(){var r;return _regenerator.default.wrap(function e(t){while(1){switch(t.prev=t.next){case 0:t.next=2;return a.text();case 2:r=t.sent;this.logger.trace("spaceDocumentExists response ".concat(a.status,": ").concat(r));return t.abrupt("return",a.status===200);case 5:case"end":return t.stop()}}},e,this)}))});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}},e,this)}))};this.createDefaultSpaceDocument=function(a,n){return __awaiter(i,void 0,void 0,_regenerator.default.mark(function e(){var r=this;return _regenerator.default.wrap(function e(t){while(1){switch(t.prev=t.next){case 0:this.logger.trace("Creating default space document for index: ".concat(a));t.next=3;return this.esClient.postAsKibana(a+"/_create/".concat(this.DEFAULT_SPACE_DOCUMENT_ID,"?refresh=true"),JSON.stringify(n)).then(function(a){return __awaiter(r,void 0,void 0,_regenerator.default.mark(function e(){var r;return _regenerator.default.wrap(function e(t){while(1){switch(t.prev=t.next){case 0:t.next=2;return a.text();case 2:r=t.sent;this.logger.trace("createDefaultSpaceDocument response ".concat(a.status,": ").concat(r));case 4:case"end":return t.stop()}}},e,this)}))});case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}},e,this)}))};this.defaultKibanaIndex=t;this.esClient=r};exports.DefaultSpaceCreator=DefaultSpaceCreator;