"use strict";window.console=window.console||{log:function n(){}};function parseInjectedArray(e,o){try{return JSON.parse(o)}catch(n){console.log("Could not parse ".concat(e," from: ").concat(o))}return[]}var NEXT_URL_PARAM='nextUrl';var BASE_PATH='${basePath}';var CLEAR_SESSION_ON_EVENTS=parseInjectedArray('clearSessionOnEvents','${clearSessionOnEvents}');var SSO_CONNECTORS=parseInjectedArray('ssoConnectors','${ssoConnectors}');$.blockUI.defaults={message:null,onBlock:function n(){return $('#spinner').fadeIn(1200)},onUnblock:function n(){return $('#spinner').hide()}};$(document).ajaxStart($.blockUI).ajaxStop($.unblockUI);function getParameterByName(n){var e=new URLSearchParams(window.location.search).get(n);return e?decodeURIComponent(e):null}function buildNextUrlQueryParam(){var n=getParameterByName(NEXT_URL_PARAM);if(n){return encodeURIComponent(n+window.location.hash)}return encodeURIComponent(window.location.hash)}function initLocalStorage(){if(window.localStorage){window.localStorage.setItem("insecureClusterWarningVisibility".concat(BASE_PATH),'{ "show": false }')}}function initSessionStorage(){if(window.sessionStorage){var n=buildNextUrlQueryParam();console.log("Setting nextUrl to:"+n);window.sessionStorage.setItem(NEXT_URL_PARAM,n)}}function displayFormMessage(n){$("#form-username").val('').focus();$("#form-password").val('');$("#form-message").text(n);$(".form-wrapper").shake({speed:45,distance:5,direction:"down"})}function buildLoginRequest(){return{method:'POST',redirect:'follow',headers:{"Content-Type":"application/json;charset=UTF-8"},body:JSON.stringify({username:$("#form-username").val(),password:$("#form-password").val()})}}function onLoginRequestSuccess(n){if(n.status!==200){throw n}clearSessionOnEvents();return n.json()}function onLoginRequestError(n){switch(n.status){case 401:n.json().then(function(n){displayFormMessage(n.message)});break;default:displayFormMessage('Wrong credentials')}}function buildLoginUri(){var n=buildNextUrlQueryParam();var e="".concat(BASE_PATH,"/login");return n?"".concat(e,"?").concat(NEXT_URL_PARAM,"=").concat(n):e}function redirectAfterLogin(n){var e=n.split('redirectTo=')[1];var o=new URL("".concat(window.location.origin).concat(n));if(e){o.hash='';o.searchParams.set('redirectTo',encodeURIComponent(e))}return window.location.href=o.href}function submitFormAndHeader(){return fetch(buildLoginUri(),buildLoginRequest()).then(onLoginRequestSuccess).then(function(n){redirectAfterLogin(n.nextUrl)}).catch(onLoginRequestError)}function fillAuthConnectorsButtons(){SSO_CONNECTORS.map(function(n){var e=n.buttonName?n.buttonName:"Enter using ".concat(n.name," üåç");var o="\n    <div id=\"saml_auth\">\n      <a style=\"display: block\" href=\"".concat(n.loginUrl,"\"><button class=\"loginButton saml-submit ").concat(n.type,"Button\">").concat(e,"</button></a>\n    </div>");$('#connectors_auth').append(o).show()})}function clearSessionOnEvents(){if(CLEAR_SESSION_ON_EVENTS&&CLEAR_SESSION_ON_EVENTS.includes('login')){console.log("Will clear localstorage and session storage - login phase");if(window.localStorage){var n,e;(n=window.localStorage)===null||n===void 0?void 0:n.clear();window.localStorage.setItem("insecureClusterWarningVisibility".concat(BASE_PATH),'{ "show": false}');(e=window.sessionStorage)===null||e===void 0?void 0:e.clear()}}}initLocalStorage();initSessionStorage();$("#login_form").on('submit',function(n){n.preventDefault();submitFormAndHeader()});$("#form-username").focus();fillAuthConnectorsButtons();if(typeof module!=='undefined'&&module.hasOwnProperty('exports')){module.exports={submitFormAndHeader:submitFormAndHeader,CLEAR_SESSION_ON_EVENTS:CLEAR_SESSION_ON_EVENTS,redirectAfterLogin:redirectAfterLogin}}