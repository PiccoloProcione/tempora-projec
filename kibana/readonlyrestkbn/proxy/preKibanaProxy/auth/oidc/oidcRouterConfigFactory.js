"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.OidcRouterConfig=exports.OidcRouterConfigFactory=void 0;var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));var _createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));var _rorLoggerFactory=require("../../../core/logging/rorLoggerFactory");var SSO_PREFIX="ror_kbn_";var ROUTES={LOGIN:'/login-ep',LOGOUT:'/logout-ep',LOGIN_CALLBACK:'/callback',LOGOUT_CALLBACK:'/logout-callback'};var OidcRouterConfigFactory=function(){function i(t,o){(0,_classCallCheck2.default)(this,i);this.basePath=t;this.cookieConfig=o;this.logger=_rorLoggerFactory.RorLoggerFactory.getLoggerForFile(__filename)}(0,_createClass2.default)(i,[{key:"constructFrom",value:function t(o){var e=this;if(!o){return[]}if(!i.signatureKeyExists(o)){this.logger.info("No auth.signature_key set");return[]}if(!i.oidcConfigurationsExist(o)){this.logger.info("No OIDC configurations found");return[]}var r=o.oidcConfigurations.filter(function(t){return t.enabled});if(r.length==0){this.logger.info("No enabled OIDC configurations found");return[]}return r.map(function(t){return new OidcRouterConfig(e.basePath,t,e.cookieConfig)})}}],[{key:"signatureKeyExists",value:function t(o){return Boolean(o.signatureKey)}},{key:"oidcConfigurationsExist",value:function t(o){var e;return((e=o.oidcConfigurations)===null||e===void 0?void 0:e.length)!=0}}]);return i}();exports.OidcRouterConfigFactory=OidcRouterConfigFactory;var OidcRouterConfig=function(){function r(t,o,e){(0,_classCallCheck2.default)(this,r);this.connectorName=o.name;this.buttonName=o.buttonName;this.routerPath="".concat(t,"/").concat(SSO_PREFIX).concat(o.name);this.scope=o.scope;this.issuer=o.issuer;this.usernameParameter=o.usernameParameter;this.groupsParameter=o.groupsParameter;this.clientId=o.clientId;this.clientSecret=o.clientSecret;this.oidcTokenURL=o.tokenURL;this.oidcAuthorizationURL=o.authorizationURL;this.oidcUserInfoURL=o.userInfoURL;this.oidcLogoutUrl=o.logoutUrl;this.loginPath=ROUTES.LOGIN;this.logoutPath=ROUTES.LOGOUT;this.loginCallbackPath=ROUTES.LOGIN_CALLBACK;this.logoutCallbackPath=ROUTES.LOGOUT_CALLBACK;this.loginCallbackURL="".concat(o.protocol,"://").concat(o.kibanaExternalHost+this.routerPath+ROUTES.LOGIN_CALLBACK);this.logoutCallbackUrl="".concat(o.protocol,"://").concat(o.kibanaExternalHost+this.routerPath+ROUTES.LOGOUT_CALLBACK);this.cookieConfig={name:"".concat(e.name,"_").concat(o.name),password:e.password}}(0,_createClass2.default)(r,[{key:"loginPathRelativeToRoot",value:function t(){return"".concat(this.routerPath).concat(this.loginPath)}},{key:"logoutPathRelativeToRoot",value:function t(){return"".concat(this.routerPath).concat(this.logoutPath)}},{key:"toLegacySsoButtonProps",value:function t(){return{name:this.connectorName,type:"oidc",buttonName:this.buttonName,loginUrl:this.loginPathRelativeToRoot()}}}]);return r}();exports.OidcRouterConfig=OidcRouterConfig;