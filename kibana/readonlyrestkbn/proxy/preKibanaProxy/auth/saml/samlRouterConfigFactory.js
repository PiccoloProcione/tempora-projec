"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.SamlRouterConfig=exports.SamlRouterConfigFactory=void 0;var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));var _createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));var _rorLoggerFactory=require("../../../core/logging/rorLoggerFactory");var SSO_PREFIX="ror_kbn_";var ROUTES={LOGIN:'/login',LOGOUT:'/logout',LOGIN_CALLBACK:'/assert',LOGOUT_CALLBACK:'/notifylogout'};var SamlRouterConfigFactory=function(){function a(t,e){(0,_classCallCheck2.default)(this,a);this.basePath=t;this.cookieConfig=e;this.logger=_rorLoggerFactory.RorLoggerFactory.getLoggerForFile(__filename)}(0,_createClass2.default)(a,[{key:"constructFrom",value:function t(e){var o=this;if(!e){return[]}if(!a.signatureKeyExists(e)){this.logger.info("No auth.signature_key set");return[]}if(!a.samlConfigurationsExist(e)){this.logger.info("No SAML configurations found");return[]}var r=e.samlConfigurations.filter(function(t){return t.enabled});if(r.length==0){this.logger.info("No enabled SAML configurations found");return[]}return r.map(function(t){return new SamlRouterConfig(o.basePath,t,o.cookieConfig)})}}],[{key:"signatureKeyExists",value:function t(e){return Boolean(e.signatureKey)}},{key:"samlConfigurationsExist",value:function t(e){var o;return((o=e.samlConfigurations)===null||o===void 0?void 0:o.length)!=0}}]);return a}();exports.SamlRouterConfigFactory=SamlRouterConfigFactory;var SamlRouterConfig=function(){function r(t,e,o){(0,_classCallCheck2.default)(this,r);this.connectorName=e.name;this.protocol=e.protocol;this.entryPoint=e.entryPoint;this.issuer=e.issuer;this.usernameParameter=e.usernameParameter;this.groupsParameter=e.groupsParameter;this.buttonName=e.buttonName;this.loginPath=ROUTES.LOGIN;this.logoutPath=ROUTES.LOGOUT;this.loginCallbackPath=ROUTES.LOGIN_CALLBACK;this.logoutCallbackPath=ROUTES.LOGOUT_CALLBACK;this.routerPath="".concat(t,"/").concat(SSO_PREFIX).concat(e.name);this.callbackURL="".concat(e.protocol,"://").concat(e.kibanaExternalHost+this.routerPath+ROUTES.LOGIN_CALLBACK);this.logoutCallbackUrl="".concat(e.protocol,"://").concat(e.kibanaExternalHost+this.routerPath+ROUTES.LOGOUT_CALLBACK);this.cert=e.cert;this.privateCert=e.privateCert;this.decryptionPvk=e.decryptionPvk;this.extraConfig=e.extraConfig;this.cookieConfig={name:"".concat(o.name,"_").concat(this.connectorName),password:o.password}}(0,_createClass2.default)(r,[{key:"loginPathRelativeToRoot",value:function t(){return"".concat(this.routerPath).concat(this.loginPath)}},{key:"logoutPathRelativeToRoot",value:function t(){return"".concat(this.routerPath).concat(this.logoutPath)}},{key:"toLegacySsoButtonProps",value:function t(){return{name:this.connectorName,type:"saml",buttonName:this.buttonName,loginUrl:this.loginPathRelativeToRoot()}}}]);return r}();exports.SamlRouterConfig=SamlRouterConfig;