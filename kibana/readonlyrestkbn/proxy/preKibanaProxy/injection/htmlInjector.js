"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.HtmlInjector=void 0;var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));var _createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));var _rorLoggerFactory=require("../../core/logging/rorLoggerFactory");var _distributionInfoProvider=require("../../../kibana/patchers/distributionInfoProvider");var HTML_HEAD_CLOSING_TAG='</head>';var HTML_BODY_CLOSING_TAG="</body>";var HtmlInjector=function(){function i(t,s,e){(0,_classCallCheck2.default)(this,i);this.logger=_rorLoggerFactory.RorLoggerFactory.getLoggerForFile(__filename);this.kibanaBasePath=t;this.customUserCss=s;this.customUserCssFileContent=e}(0,_createClass2.default)(i,[{key:"injectCssAndJsScriptsIntoHtml",value:function t(s){var e=this.customUserCss!=null;var i=this.customUserCssFileContent!=null;this.logger.trace("Injecting JS scripts."+"Injecting custom user css: ".concat(e,". ")+"Injecting custom user css file content: ".concat(i));var a=s.toString().split(HTML_HEAD_CLOSING_TAG);var r=a[1]&&a[1].split(HTML_BODY_CLOSING_TAG);var c=this.buildHtmlHeadInjections(e,i);var n=this.buildHtmlBodyInjections();var o=[a[0],c,HTML_HEAD_CLOSING_TAG,r[0],n,HTML_BODY_CLOSING_TAG,r[1]].map(function(t){return Buffer.from(t)});return Buffer.concat(o)}},{key:"buildHtmlHeadInjections",value:function t(s,e){var i=_distributionInfoProvider.DistributionInfoProvider.isEnvironmentDev()?this.getLessNotCompiledToCssInjection():this.getLessCompiledToCssInjection();if(s){i+="<style>".concat(this.customUserCss,"</style>")}if(e){i+="<style>".concat(this.customUserCssFileContent,"</style>")}return i}},{key:"getLessNotCompiledToCssInjection",value:function t(){return"<link rel=\"stylesheet/less\" type=\"text/css\" href=\"".concat(this.kibanaBasePath,"/pkp/legacy/web/assets/less/main.less\"/>")+"<script type=\"application/javascript\" src=\"".concat(this.kibanaBasePath,"/pkp/autodeps?file=less/dist/less.min.js\"><\/script>")}},{key:"getLessCompiledToCssInjection",value:function t(){return"<link rel=\"stylesheet\" type=\"text/css\" href=\"".concat(this.kibanaBasePath,"/pkp/legacy/web/assets/css/main.css\"/>")}},{key:"buildHtmlBodyInjections",value:function t(){var s="<script type=\"application/javascript\" src=\"".concat(this.kibanaBasePath,"/pkp/legacy/web/assets/js/ie-alert.js\"><\/script>")+"<script type=\"application/javascript\" src=\"".concat(this.kibanaBasePath,"/pkp/autodeps?file=jquery/dist/jquery.min.js\"><\/script>")+"<script type=\"application/javascript\" src=\"".concat(this.kibanaBasePath,"/pkp/autodeps?file=xregexp/xregexp-all.js\"><\/script>")+"<script type=\"application/javascript\" src=\"".concat(this.kibanaBasePath,"/pkp/injections/hidden-apps.js\"><\/script>")+"<script type=\"application/javascript\" src=\"".concat(this.kibanaBasePath,"/pkp/injections/ror-css-classes.js\"><\/script>")+"<script type=\"application/javascript\" src=\"".concat(this.kibanaBasePath,"/pkp/autodeps?file=js-cookie/dist/js.cookie.min.js\"><\/script>")+"<script type=\"application/javascript\" src=\"".concat(this.kibanaBasePath,"/pkp/injections/session-probe.js\"><\/script>")+"<script type=\"application/javascript\" src=\"".concat(this.kibanaBasePath,"/pkp/injections/trial-expiration-alert.js\"><\/script>");s+="<script type=\"application/javascript\" defer src=\"".concat(this.kibanaBasePath,"/pkp/injections/custom.js\"><\/script>");return s}}]);return i}();exports.HtmlInjector=HtmlInjector;