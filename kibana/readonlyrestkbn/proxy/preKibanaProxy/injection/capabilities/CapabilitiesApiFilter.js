"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.CapabilitiesApiFilter=void 0;var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));var _createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));var _lodash=_interopRequireDefault(require("lodash"));var _rorLoggerFactory=require("../../../core/logging/rorLoggerFactory");var _2=require(".");var _jsonStableStringify=_interopRequireDefault(require("json-stable-stringify"));var CapabilitiesApiFilter=function(){function s(){(0,_classCallCheck2.default)(this,s)}(0,_createClass2.default)(s,null,[{key:"shouldInterceptRequestBody",value:function e(r){return r.path==='/api/core/capabilities'}},{key:"interceptRequestBody",value:function e(r,t){var i;var a=(i=r.rorRequest.getIdentitySession())===null||i===void 0?void 0:i.metadata;if(!a){return t}var l=this.fromResponseBuffer(t);var o=(0,_2.transform)(l,a);s.logger.trace('Modified intercepted body to: ',o);return Buffer.from((0,_jsonStableStringify.default)(o,{space:'  '}))}},{key:"fromResponseBuffer",value:function e(r){var t=null;try{t=JSON.parse(r.toString())}catch(e){s.logger.warn('Problem with parsing JSON '+r.toString().substr(0,30)+'...')}if(!t||_lodash.default.isEmpty(t['navLinks'])||_lodash.default.isEmpty(t['catalogue'])){s.logger.error("Bad object parsed!! ".concat(JSON.stringify(t)))}return t}}]);return s}();exports.CapabilitiesApiFilter=CapabilitiesApiFilter;CapabilitiesApiFilter.logger=_rorLoggerFactory.RorLoggerFactory.getLoggerForFile(__filename);