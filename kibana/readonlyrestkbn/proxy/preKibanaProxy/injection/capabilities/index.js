"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.mutateAllCapabilitiesInObject=mutateAllCapabilitiesInObject;exports.transform=transform;exports.overridePropertyByJsonPath=overridePropertyByJsonPath;exports.overridePropertiesByJsonPath=overridePropertiesByJsonPath;exports.getCapabilitiesToRemove=getCapabilitiesToRemove;var _toConsumableArray2=_interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));var _HiddenAppsTransformer=require("./transformers/HiddenAppsTransformer");var _ROUserTransformer=require("./transformers/ROUserTransformer");var _ManagementDisableTransformer=require("./transformers/ManagementDisableTransformer");var _kibanaAppsRegistry=require("../../kibana_apps/kibanaAppsRegistry");var _rorLoggerFactory=require("../../../core/logging/rorLoggerFactory");function _createForOfIteratorHelper(e,r){var t;if(typeof Symbol==="undefined"||e[Symbol.iterator]==null){if(Array.isArray(e)||(t=_unsupportedIterableToArray(e))||r&&e&&typeof e.length==="number"){if(t)e=t;var n=0;var a=function r(){};return{s:a,n:function r(){if(n>=e.length)return{done:true};return{done:false,value:e[n++]}},e:function r(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o=true,i=false,s;return{s:function r(){t=e[Symbol.iterator]()},n:function r(){var e=t.next();o=e.done;return e},e:function r(e){i=true;s=e},f:function r(){try{if(!o&&t.return!=null)t.return()}finally{if(i)throw s}}}}function _unsupportedIterableToArray(r,e){if(!r)return;if(typeof r==="string")return _arrayLikeToArray(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor)t=r.constructor.name;if(t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return _arrayLikeToArray(r,e)}function _arrayLikeToArray(r,e){if(e==null||e>r.length)e=r.length;for(var t=0,n=new Array(e);t<e;t++){n[t]=r[t]}return n}var logger=_rorLoggerFactory.RorLoggerFactory.getLoggerForFile(__filename);function mutateAllCapabilitiesInObject(r,e){for(var t in r){if(r[t]!==undefined){r[t]=e(t)}else{console.log("Tried to mutate NON existing property "+t+" of ",r)}}return r}function transform(r,t){r=[_HiddenAppsTransformer.HiddenAppsTransformer.transform,_ROUserTransformer.ROUserTransformer.transform,_ManagementDisableTransformer.ManagementDisableTransformer.transform].reduce(function(r,e){return e(r,t)},r);overridePropertiesByJsonPath(r,["navLinks.management","catalogue.indexPatterns","catalogue.saved_objects","savedObjectManagement.read","management.insightsAndAlerting.reporting","management.kibana.indexPatterns","management.kibana.objects","kibana.objects"],function(){return true});return r}function overridePropertyByJsonPath(r,e,t){var n=e.split('.');var a;for(a=0;a<n.length-1;a++){var o=r[n[a]];if(o===undefined){return}r=o}if(r[n[a]]===undefined){return}r[n[a]]=t}function overridePropertiesByJsonPath(e,r,t){r.forEach(function(r){return overridePropertyByJsonPath(e,r,t(r))})}function getCapabilitiesToRemove(r){var e=r.kibanaHiddenApps;if(e.length===0){return[]}var t=[];var n=_createForOfIteratorHelper(e),a;try{for(n.s();!(a=n.n()).done;){var o=a.value;t=t.concat(_kibanaAppsRegistry.KibanaAppsRegistry.app2capabilities(o)||[])}}catch(r){n.e(r)}finally{n.f()}t=(0,_toConsumableArray2.default)(new Set(t.map(function(r){return r===null||r===void 0?void 0:r.trim()}).filter(function(r){return Boolean(r)})));logger.debug("Will hide apps ".concat(e,". Hence will remove capabilities: ").concat(t));return t}