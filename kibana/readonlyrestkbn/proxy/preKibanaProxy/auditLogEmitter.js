"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.AuditLogEmitter=void 0;var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator"));var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));var _createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));var _rorLoggerFactory=require("../core/logging/rorLoggerFactory");var __awaiter=void 0&&(void 0).__awaiter||function(e,o,r,u){function s(t){return t instanceof r?t:new r(function(e){e(t)})}return new(r||(r=Promise))(function(t,r){function n(e){try{a(u.next(e))}catch(e){r(e)}}function i(e){try{a(u["throw"](e))}catch(e){r(e)}}function a(e){e.done?t(e.value):s(e.value).then(n,i)}a((u=u.apply(e,o||[])).next())})};var AUDIT_EVENT_TYPE;(function(e){e["LOGOUT"]="logout"})(AUDIT_EVENT_TYPE||(AUDIT_EVENT_TYPE={}));var AuditLogEmitter=function(){function i(e){(0,_classCallCheck2.default)(this,i);this.esClient=e;this.logger=_rorLoggerFactory.RorLoggerFactory.getLoggerForFile(__filename)}(0,_createClass2.default)(i,[{key:"emitLogoutEvent",value:function e(r,n){return __awaiter(this,void 0,void 0,_regenerator.default.mark(function e(){return _regenerator.default.wrap(function e(t){while(1){switch(t.prev=t.next){case 0:t.next=2;return this.emitAuditEvent(r,{event_type:AUDIT_EVENT_TYPE.LOGOUT,agent:i.AGENT_NAME,origin:n});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}},e,this)}))}},{key:"emitAuditEvent",value:function e(n,i){return __awaiter(this,void 0,void 0,_regenerator.default.mark(function e(){var r;return _regenerator.default.wrap(function e(t){while(1){switch(t.prev=t.next){case 0:this.logger.debug("Emitting audit log event: ".concat(JSON.stringify(i)));t.prev=1;t.next=4;return this.esClient.postAuditEvent(n,i);case 4:r=t.sent;if(!(r.status<300)){t.next=8;break}this.logger.debug("Successfully emitted audit event: ".concat(JSON.stringify(i)," response: ").concat(JSON.stringify(r)));return t.abrupt("return");case 8:this.logger.error("Error ".concat(r.status," for ").concat(i.event_type," audit event submission. (Message: ").concat(r.statusMessage,")"));t.next=15;break;case 11:t.prev=11;t.t0=t["catch"](1);this.logger.error('Error emitting audit event:',t.t0);return t.abrupt("return");case 15:case"end":return t.stop()}}},e,this,[[1,11]])}))}}]);return i}();exports.AuditLogEmitter=AuditLogEmitter;AuditLogEmitter.AGENT_NAME="readonlyrestkbn";