"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.DirectAccessProxyBuilder=void 0;var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator"));var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));var _createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));var _expressHttpProxy=_interopRequireDefault(require("express-http-proxy"));var _rorLoggerFactory=require("../core/logging/rorLoggerFactory");var __awaiter=void 0&&(void 0).__awaiter||function(e,n,t,u){function s(r){return r instanceof t?r:new t(function(e){e(r)})}return new(t||(t=Promise))(function(r,t){function a(e){try{i(u.next(e))}catch(e){t(e)}}function o(e){try{i(u["throw"](e))}catch(e){t(e)}}function i(e){e.done?r(e.value):s(e.value).then(a,o)}i((u=u.apply(e,n||[])).next())})};var DirectAccessProxyBuilder=function(){function t(e,r){var a=this;(0,_classCallCheck2.default)(this,t);this.kibanaUrl=e;this.pkpKibanaToken=r;this.authorizationHeaderDecorator=function(t,e){return __awaiter(a,void 0,void 0,_regenerator.default.mark(function e(){return _regenerator.default.wrap(function e(r){while(1){switch(r.prev=r.next){case 0:t.headers["x-ror-pkp-kibana-token"]=this.pkpKibanaToken;return r.abrupt("return",t);case 2:case"end":return r.stop()}}},e,this)}))};this.proxyErrorHandler=function(e,r,t){_rorLoggerFactory.RorLoggerFactory.getLoggerForFile(__filename).trace("error: ",e);t(e)}}(0,_createClass2.default)(t,[{key:"build",value:function e(){var r={https:false,preserveHostHdr:true,parseReqBody:true,proxyReqOptDecorator:this.authorizationHeaderDecorator,proxyErrorHandler:this.proxyErrorHandler};return(0,_expressHttpProxy.default)(this.kibanaUrl,r)}}]);return t}();exports.DirectAccessProxyBuilder=DirectAccessProxyBuilder;