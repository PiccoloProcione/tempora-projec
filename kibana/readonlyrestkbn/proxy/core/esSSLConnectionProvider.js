"use strict";var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard");var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.SSLVerificationMode=exports.SSLCertificationType=exports.EsSSLConnectionProvider=void 0;var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));var _createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));var _fs=_interopRequireDefault(require("fs"));var _https=_interopRequireDefault(require("https"));var http=_interopRequireWildcard(require("http"));var _distributionInfoProvider=require("../../kibana/patchers/distributionInfoProvider");var EsSSLConnectionProvider=function(){function t(e){(0,_classCallCheck2.default)(this,t);this.verificationMode=e.verificationMode?SSLVerificationMode[e.verificationMode.toUpperCase()]:SSLVerificationMode.FULL;if(!e.sslEnabled){this.connectionAgent=http.globalAgent;this.certificationType=SSLCertificationType.NONE;this.verificationMode=SSLVerificationMode.NONE;return}if(e.certificateAuthorities){this.setCertificationAuthorities(e.certificateAuthorities);return}if(e.truststorePath){this.setTruststore(e.truststorePath,e.truststorePassword);return}this.setNoCertificationSSL()}(0,_createClass2.default)(t,[{key:"getConnectionAgent",value:function e(){return this.connectionAgent}},{key:"getCertificationType",value:function e(){return this.certificationType}},{key:"getCertificateAuthorities",value:function e(){return this.certificateAuthorities}},{key:"getTruststore",value:function e(){return{truststore:this.truststore,password:this.truststorePassword}}},{key:"isVerificationEnabled",value:function e(){return!_distributionInfoProvider.DistributionInfoProvider.isEnvironmentDev()&&this.verificationMode!==SSLVerificationMode.NONE}},{key:"setCertificationAuthorities",value:function e(t){var i=this;this.certificateAuthorities=[];t.forEach(function(e){return i.certificateAuthorities.push(_fs.default.readFileSync(e))});var r={ca:this.certificateAuthorities,rejectUnauthorized:this.isVerificationEnabled()};this.connectionAgent=new _https.default.Agent(r);this.certificationType=SSLCertificationType.PEM}},{key:"setTruststore",value:function e(t,i){this.truststore=_fs.default.readFileSync(t);this.truststorePassword=i;var r={pfx:this.truststore,passphrase:this.truststorePassword,rejectUnauthorized:this.isVerificationEnabled()};this.connectionAgent=new _https.default.Agent(r);this.certificationType=SSLCertificationType.PKC12}},{key:"setNoCertificationSSL",value:function e(){this.certificationType=SSLCertificationType.NONE;var t={rejectUnauthorized:this.isVerificationEnabled()};this.connectionAgent=new _https.default.Agent(t)}}]);return t}();exports.EsSSLConnectionProvider=EsSSLConnectionProvider;var SSLCertificationType;exports.SSLCertificationType=SSLCertificationType;(function(e){e[e["PEM"]=0]="PEM";e[e["PKC12"]=1]="PKC12";e[e["NONE"]=2]="NONE"})(SSLCertificationType||(exports.SSLCertificationType=SSLCertificationType={}));var SSLVerificationMode;exports.SSLVerificationMode=SSLVerificationMode;(function(e){e[e["FULL"]=0]="FULL";e[e["CERTIFICATE"]=1]="CERTIFICATE";e[e["NONE"]=2]="NONE"})(SSLVerificationMode||(exports.SSLVerificationMode=SSLVerificationMode={}));