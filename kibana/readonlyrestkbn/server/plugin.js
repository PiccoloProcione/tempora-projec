"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.ReadonlyrestKbnPlugin=void 0;var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator"));var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));var _createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));var _distributionInfoProvider=require("../kibana/patchers/distributionInfoProvider");var _kibanaPatcher=require("../kibana/patchers/kibanaPatcher");var __awaiter=void 0&&(void 0).__awaiter||function(e,l,n,o){function u(t){return t instanceof n?t:new n(function(e){e(t)})}return new(n||(n=Promise))(function(t,n){function r(e){try{i(o.next(e))}catch(e){n(e)}}function a(e){try{i(o["throw"](e))}catch(e){n(e)}}function i(e){e.done?t(e.value):u(e.value).then(r,a)}i((o=o.apply(e,l||[])).next())})};var ReadonlyrestKbnPlugin=function(){function ReadonlyrestKbnPlugin(e){(0,_classCallCheck2.default)(this,ReadonlyrestKbnPlugin);this.initializerContext=e;this.logger=e.logger.get()}(0,_createClass2.default)(ReadonlyrestKbnPlugin,[{key:"setup",value:function setup(core){return __awaiter(this,void 0,void 0,_regenerator.default.mark(function _callee(){return _regenerator.default.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:eval(atob('aWYoZXZhbChhdG9iKCJNVFkwTlRReU16WTBPRGN5TlNBK0lEQWdKaVlnY0dGeWMyVkpiblFvWVhSdllpZ2lUVlJaTUU5RVJUUlBSRkY0VGtSRk5FMVJQVDBpS1NrZ1BDQW9ibVYzSUVSaGRHVW9LU2t1WjJWMFZHbHRaU2dwIikpKXt0aHJvdyBuZXcgRXJyb3IoYXRvYigiVW1WaFpHOXViSGxTUlZOVUlHWnZjaUJMYVdKaGJtRWdhR0ZzZEdWa0lHSmxZMkYxYzJVZ2VXOTFjaUIwY21saGJDQm9ZWE1nWlhod2FYSmxaQ3dnYjNJZ2RHaHBjeUJpZFdsc1pDQnBjeUIzWVhrZ2RHOXZJRzlzWkM0Z1IyVjBJSFJvWlNCc1lYUmxjM1FnWW5WcGJHUXNJRzl5SUdkbGRDQmhjM05wYzNSaGJtTmxJR0YwSUdGMElHaDBkSEJ6T2k4dmNtVmhaRzl1YkhseVpYTjBMbU52YlE9PSIpKX0='));this.logger.info("Setting up ReadonlyREST plugin - build info: "+_distributionInfoProvider.DistributionInfoProvider.getInstance().toString());this.logger.debug('readonlyrest_kbn: Setup');return _context.abrupt("return",{});case 4:case"end":return _context.stop()}}},_callee,this)}))}},{key:"start",value:function e(t){this.checkIfInstallationFinished();return{}}},{key:"stop",value:function e(){this.logger.debug('readonlyrest_kbn: Stopped')}},{key:"checkIfInstallationFinished",value:function e(){if((0,_kibanaPatcher.isPatchedAll)()){this.logger.debug('readonlyrest_kbn: Started')}else{console.log("######################################################\n#######    READONLYREST INSTALLATION ERROR    ########\n######################################################");this.logger.error('ReadonlyREST plugin installation is not finished yet, an additional patching kibana step is required. Check documentation https://docs.readonlyrest.com/kibana#patching-kibana for more references');process.exit()}}}]);return ReadonlyrestKbnPlugin}();exports.ReadonlyrestKbnPlugin=ReadonlyrestKbnPlugin;